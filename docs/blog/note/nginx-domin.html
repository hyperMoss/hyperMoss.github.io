<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx 变更 html 静态资源内容 | HyperMoss</title>
    <meta name="description" content="Just playing.">
    <link rel="stylesheet" href="/assets/style.019f39fc.css">
    <link rel="modulepreload" href="/assets/Home.bc1910cd.js">
    <link rel="modulepreload" href="/assets/app.98c1581b.js">
    <link rel="modulepreload" href="/assets/docs_blog_note_nginx-domin.md.e3526205.lean.js">
    
    <meta name="twitter:title" content="nginx 变更 html 静态资源内容 | HyperMoss">
    <meta property="og:title" content="nginx 变更 html 静态资源内容 | HyperMoss">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="HyperMoss, back to home" data-v-675d8756 data-v-4a583abe><!----> HyperMoss</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/docs/blog/index" data-v-b8818f8c>博文 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/docs/study/index" data-v-b8818f8c>学习笔记 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/hyperMoss/hyperMoss.github.io" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/docs/blog/index" data-v-b8818f8c>博文 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/docs/study/index" data-v-b8818f8c>学习笔记 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/hyperMoss/hyperMoss.github.io" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">interview</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/interview/interview1"> 小前端的笔试题1</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/interview/interview2"> 正则表达式+小前端的笔试题2</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/interview/mohayo"> 米哈游信息系统</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/interview/shein1"> Shein</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/interview/shopee1"> 虾皮market</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/interview/shopee2"> 虾皮IM</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">note</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/2020-2021"> 2020-2021年终总结</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/chrome-extension"> Chrome插件开发</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/egg-assets-umi"> eggjs 和 umi 的配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/how-to-learn"> 学习方法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/js-reference"> JS 引用导致的常见问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/js-sort"> JS排序算法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/docs/blog/note/nginx-domin"> nginx 变更 html 静态资源内容</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#起因">起因</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#解决方案">解决方案</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#利用-nginx-模块">利用 nginx 模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#注意事项">注意事项</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/pixivic"> Pixivic架构</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/review"> 关于复盘</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/useful-class"> 常见的设计模式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/useful-nodejs"> jenkins前端构建打包</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/vite-plugin"> 从0到1制作一个vite插件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/vitepress-auto-confit"> vitepress 自动配置目录</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/note/webpack-okr"> 如果Webpack也有OKR</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">source-code</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/blog/source-code/read-source-code"> 源码阅读</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="nginx-变更-html-静态资源内容" tabindex="-1">nginx 变更 html 静态资源内容 <a class="header-anchor" href="#nginx-变更-html-静态资源内容" aria-hidden="true">#</a></h1><p>使用 nginx 实现特殊服务器上前端页面的同一套代码不同的逻辑控制</p><h2 id="起因" tabindex="-1">起因 <a class="header-anchor" href="#起因" aria-hidden="true">#</a></h2><p>有多套站点需要使用同一套前端代码,但是不同站所需要跳转的另一套配套域名不同，需要在前端代码测做到不同站点跳转相应的域名</p><div class="language-"><pre><code>eu.test.com -&gt; eu-other.com
us.test.com -&gt; us-other.com
cn.test.com -&gt; cn-other.com
</code></pre></div><p>其实当前站点是不知道现在是哪套环境下的前端代码的 这就引出了一个问题，如何让前端知道自己是在哪个环境下的呢？</p><h2 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-hidden="true">#</a></h2><ol><li><p>打包时配置环境变量，多套代码分别部署不同环境</p></li><li><p>同一套代码，通过在 nginx 上配置不同的入口控制，比如 eu 进 eu-index.html，us 进 us-index.html，cn 进 cn-index.html</p></li></ol><p>方案 1：</p><ul><li>优点 设置简单</li><li>缺点 发布操作繁琐，需要等三个包都打包出来，并分别部署</li></ul><p>方案 2：</p><ul><li>优点 只要部署一套代码即可，运维参与维护也较简单</li><li>缺点 在 ejs 中需要配置相应的规则，并在 webpack 中配置，比较繁琐</li></ul><h2 id="利用-nginx-模块" tabindex="-1">利用 nginx 模块 <a class="header-anchor" href="#利用-nginx-模块" aria-hidden="true">#</a></h2><p>nginx 其实有一些模块能更改静态资源的部署，例如<code>ngx_http_sub_module</code>，它可以更改静态资源的路径，比如更改 <code>/static/</code> 为 <code>/static-eu/</code>，或 html 中代码<code>baidu.com</code>更改为<code>google.com</code></p><p>既然如此也能改 script 标签中的内容</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span>env <span class="token operator">=</span> <span class="token string">&#39;cn-env&#39;</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>例如如上内容可以通过配置</p><div class="language-conf"><pre><code>
        location / {
            sub_filter &#39;cn-env&#39; &#39;eu-env&#39;;
            # 配置匹配的内容
            sub_filter_types css/html;
            # 配置更改多少次
            sub_filter_once off;
            root   html;
            index  index.html index.htm;
        }
</code></pre></div><p>这样前端打印<code>window.env</code>就能得到 <code>eu-env</code></p><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-hidden="true">#</a></h2><ul><li>默认只替换 html，如果要替换别的内容要配置 <code>sub_filter_types</code></li><li>如果改的是反向代理中的内容，要注意是否被压缩，静态资源 nginx 是能自己知道的</li><li>页面上所有字段都会被替换，要设置特别一点的字段，或匹配规则</li></ul></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>最近更新:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/docs/blog/note/js-sort" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f> JS排序算法</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/docs/blog/note/pixivic" data-v-38ede35f><span class="text" data-v-38ede35f> Pixivic架构</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"docs_blog_index.md\":\"513167f5\",\"docs_blog_interview_interview1.md\":\"04c9b66f\",\"docs_blog_interview_interview2.md\":\"1be769ae\",\"docs_blog_interview_mohayo.md\":\"1d92a06c\",\"docs_blog_interview_shein1.md\":\"d56b1aee\",\"docs_blog_interview_shopee1.md\":\"026927b6\",\"docs_blog_interview_shopee2.md\":\"f070864e\",\"docs_blog_note_2020-2021.md\":\"ed1829b5\",\"docs_blog_note_chrome-extension.md\":\"80a1d178\",\"docs_blog_note_egg-assets-umi.md\":\"0b123bdb\",\"docs_blog_note_how-to-learn.md\":\"b877a56d\",\"docs_blog_note_js-reference.md\":\"b827427c\",\"docs_blog_note_js-sort.md\":\"a3eadadd\",\"docs_blog_note_nginx-domin.md\":\"e3526205\",\"docs_blog_note_pixivic.md\":\"795306f7\",\"docs_blog_note_review.md\":\"a6db53d1\",\"docs_blog_note_useful-class.md\":\"7317c353\",\"docs_blog_note_useful-nodejs.md\":\"1cc817ce\",\"docs_blog_note_vite-plugin.md\":\"60907620\",\"docs_blog_note_vitepress-auto-confit.md\":\"791091c5\",\"docs_blog_note_webpack-okr.md\":\"9756a6a7\",\"docs_blog_source-code_read-source-code.md\":\"54bceaf2\",\"docs_study_psychology_8-functions.md\":\"a10917b1\",\"docs_study_data-struct_dsday1.md\":\"1a51a48b\",\"docs_study_data-struct_dsday2.md\":\"035831b7\",\"docs_study_data-struct_dsday3.md\":\"612dc397\",\"docs_study_data-struct_dsday4.md\":\"60125da7\",\"docs_study_data-struct_dsday5.md\":\"3406f9d6\",\"docs_study_data-struct_dsday6.md\":\"832147b5\",\"docs_study_index.md\":\"c10ae9b6\",\"docs_study_javascript_jsintroduce-1.md\":\"c80bedca\",\"docs_study_javascript_jsintroduce-2.md\":\"1e0a149b\",\"docs_study_javascript_jsintroduce-3.md\":\"a6034935\",\"docs_study_learning-how-to-learn_learning-how-to-learn-part1.md\":\"aa23f510\",\"docs_study_learning-how-to-learn_learning-how-to-learn-part2.md\":\"450df88a\",\"docs_study_learning-how-to-learn_learning-how-to-learn-part3.md\":\"ecf88ee2\",\"docs_study_learning-how-to-learn_learning-how-to-learn-part4.md\":\"2097fd19\",\"index.md\":\"dae452f0\"}")</script>
    <script type="module" async src="/assets/app.98c1581b.js"></script>
    
  </body>
</html>